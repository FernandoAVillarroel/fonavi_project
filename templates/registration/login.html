 {% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sistema de Liquidación de Sueldos</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">

</head>
<body class="login-bg">
    <div class="login-panel">
        <!-- Logo -->
        <div class="login-logo">
            <div class="login-logo-icon">
                <i class="bi bi-calculator"></i>
            </div>
            <h1 class="login-logo-text">LiquidaSueldos</h1>
        </div>

        <!-- Título -->
        <h2>Iniciar Sesión</h2>
        
        <!-- Mensaje de bienvenida -->
        <div class="login-welcome">
            <i class="bi bi-shield-check me-2"></i>
            Accede de forma segura al sistema de liquidación
        </div>

        <!-- Mostrar errores si los hay -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}

        <!-- Formulario de login -->
        <form id="loginForm" method="post" action="{% url 'login' %}">
            {% csrf_token %}
            <input type="hidden" name="next" value="{% url 'dashboard' %}">
            
            <!-- Campo de usuario -->
            <div class="login-input-group">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-person"></i>
                    </span>
                    <input type="text" 
                           class="form-control" 
                           id="username" 
                           name="username" 
                           placeholder="Usuario"
                           required
                           autocomplete="username"
                           value="{{ request.POST.username|default:'' }}">
                </div>
            </div>

            <!-- Campo de contraseña -->
            <div class="login-input-group">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-lock"></i>
                    </span>
                    <input type="password" 
                           class="form-control" 
                           id="password" 
                           name="password" 
                           placeholder="Contraseña"
                           required
                           autocomplete="current-password">
                    <span class="input-group-text toggle-password" onclick="togglePassword()">
                        <i class="bi bi-eye" id="toggleIcon"></i>
                    </span>
                </div>
            </div>

            <!-- Recordar contraseña -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="remember" name="remember">
                    <label class="form-check-label" for="remember">
                        Recordarme
                    </label>
                </div>
                <a href="#" class="forgot-password">
                    <i class="bi bi-question-circle me-1"></i>
                    ¿Olvidaste tu contraseña?
                </a>
            </div>

            <!-- Botón de envío -->
            <button type="submit" class="btn btn-primary login-btn w-100">
                <i class="bi bi-box-arrow-in-right me-2"></i>
                Iniciar Sesión
            </button>
        </form>

        <!-- Enlaces adicionales -->
        <div class="text-center mt-4">
            <small class="text-muted">
                <i class="bi bi-info-circle me-1"></i>
                Sistema de Liquidación de Sueldos v2.0
            </small>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- JavaScript personalizado -->
    <script>
        // Función para mostrar/ocultar contraseña
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('toggleIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'bi bi-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'bi bi-eye';
            }
        }

        // Manejo del formulario - SIMPLIFICADO para Django
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            // Agregar clase de carga
            document.body.classList.add('login-loading');
            
            // El formulario se enviará normalmente a Django
            // Django manejará la autenticación y redirección
        });

        // Animación de entrada del panel
        document.addEventListener('DOMContentLoaded', function() {
            const panel = document.querySelector('.login-panel');
            panel.style.opacity = '0';
            panel.style.transform = 'translateY(30px)';
            
            setTimeout(() => {
                panel.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                panel.style.opacity = '1';
                panel.style.transform = 'translateY(0)';
            }, 100);
        });

        // Efectos de focus en inputs
        document.querySelectorAll('.form-control').forEach(input => {
            input.addEventListener('focus', function() {
                this.closest('.login-input-group').classList.add('focused');
            });
            
            input.addEventListener('blur', function() {
                this.closest('.login-input-group').classList.remove('focused');
            });
        });

        // Validación en tiempo real
        document.getElementById('username').addEventListener('input', function() {
            validateField(this, this.value.length >= 3, 'El usuario debe tener al menos 3 caracteres');
        });

        document.getElementById('password').addEventListener('input', function() {
            validateField(this, this.value.length >= 6, 'La contraseña debe tener al menos 6 caracteres');
        });

        function validateField(field, isValid, message) {
            const inputGroup = field.closest('.input-group');
            
            // Remover clases previas
            inputGroup.classList.remove('is-valid', 'is-invalid');
            
            // Agregar clase según validación
            if (field.value.length > 0) {
                inputGroup.classList.add(isValid ? 'is-valid' : 'is-invalid');
            }
        }

        // Manejo de errores de conexión
        window.addEventListener('online', function() {
            showMessage('Conexión restablecida', 'success');
        });

        window.addEventListener('offline', function() {
            showMessage('Sin conexión a internet', 'warning');
        });

        // Función para mostrar mensajes
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `alert alert-${type} alert-dismissible fade show`;
            messageDiv.innerHTML = `
                <i class="bi bi-${type === 'success' ? 'check-circle' : 'info-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            const form = document.getElementById('loginForm');
            form.parentNode.insertBefore(messageDiv, form);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>